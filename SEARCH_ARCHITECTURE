# ğŸ¨ System Architecture Diagram

## High-Level Architecture

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚         USER'S BROWSER              â”‚
                        â”‚  http://localhost:5173              â”‚
                        â”‚                                     â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                        â”‚  â”‚   React Application          â”‚   â”‚
                        â”‚  â”‚  - Search page               â”‚   â”‚
                        â”‚  â”‚  - Product grid              â”‚   â”‚
                        â”‚  â”‚  - Filters & pagination      â”‚   â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                        â”‚                 â”‚                    â”‚
                        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
                        â”‚   â”‚   React Query Caching      â”‚     â”‚
                        â”‚   â”‚   - 5 min stale time       â”‚     â”‚
                        â”‚   â”‚   - 10 min GC time         â”‚     â”‚
                        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                        â”‚                  â”‚                    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                HTTP POST Request
                              (body: {query, page, filters})
                                           â”‚
                                           â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   SUPABASE PLATFORM                 â”‚
                        â”‚  (https://ifwcgzdznxphmmcsuufq...)   â”‚
                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                        â”‚                                     â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                        â”‚  â”‚  EDGE FUNCTION (Deno Runtime) â”‚ â”‚
                        â”‚  â”‚  fetch-products/index.ts      â”‚ â”‚
                        â”‚  â”‚  (1,450 lines)                â”‚ â”‚
                        â”‚  â”‚                               â”‚ â”‚
                        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
                        â”‚  â”‚  â”‚ 1. Authenticate User      â”‚â”‚ â”‚
                        â”‚  â”‚  â”‚    â”œâ”€ JWT verification  â”‚â”‚ â”‚
                        â”‚  â”‚  â”‚    â””â”€ Stripe check      â”‚â”‚ â”‚
                        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
                        â”‚  â”‚              â”‚               â”‚ â”‚
                        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
                        â”‚  â”‚  â”‚ 2. Check Cache          â”‚ â”‚ â”‚
                        â”‚  â”‚  â”‚    â””â”€ Fresh < 7 days?  â”‚ â”‚ â”‚
                        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
                        â”‚  â”‚              â”‚                â”‚ â”‚
                        â”‚  â”‚              â”œâ”€ HIT (200ms)   â”‚ â”‚
                        â”‚  â”‚              â”‚  â””â”€ Return     â”‚ â”‚
                        â”‚  â”‚              â”‚                â”‚ â”‚
                        â”‚  â”‚              â””â”€ MISS (scrape) â”‚ â”‚
                        â”‚  â”‚                 â†“             â”‚ â”‚
                        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
                        â”‚  â”‚  â”‚ 3. Scrape 3 Sources (5-8s)â”‚â”‚ â”‚
                        â”‚  â”‚  â”‚    (parallel)             â”‚â”‚ â”‚
                        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
                        â”‚  â”‚              â”‚                â”‚ â”‚
                        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
                        â”‚  â”‚  â”‚ 4. Deduplicate (1-2s)   â”‚ â”‚ â”‚
                        â”‚  â”‚  â”‚    36 â†’ 25 products     â”‚ â”‚ â”‚
                        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
                        â”‚  â”‚              â”‚                â”‚ â”‚
                        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
                        â”‚  â”‚  â”‚ 5. AI Analysis (4-8s)   â”‚ â”‚ â”‚
                        â”‚  â”‚  â”‚    Generate pros/cons   â”‚ â”‚ â”‚
                        â”‚  â”‚  â”‚    Calculate scores     â”‚ â”‚ â”‚
                        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
                        â”‚  â”‚              â”‚                â”‚ â”‚
                        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
                        â”‚  â”‚  â”‚ 6. Save to Cache (1-2s) â”‚ â”‚ â”‚
                        â”‚  â”‚  â”‚    PostgreSQL DB        â”‚ â”‚ â”‚
                        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
                        â”‚  â”‚              â”‚                â”‚ â”‚
                        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
                        â”‚  â”‚  â”‚ 7. Filter & Paginate    â”‚ â”‚ â”‚
                        â”‚  â”‚  â”‚    Apply user limits    â”‚ â”‚ â”‚
                        â”‚  â”‚  â”‚    Sort results         â”‚ â”‚ â”‚
                        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
                        â”‚  â”‚              â”‚                â”‚ â”‚
                        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
                        â”‚  â”‚  â”‚ 8. Return JSON          â”‚ â”‚ â”‚
                        â”‚  â”‚  â”‚    12 products + meta   â”‚ â”‚ â”‚
                        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
                        â”‚  â”‚              â”‚                â”‚ â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                        â”‚                 â”‚                   â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                        â”‚  â”‚  POSTGRESQL DATABASE       â”‚    â”‚
                        â”‚  â”‚  (localhost:54322)         â”‚    â”‚
                        â”‚  â”‚                           â”‚    â”‚
                        â”‚  â”‚  Tables:                  â”‚    â”‚
                        â”‚  â”‚  â”œâ”€ products             â”‚    â”‚
                        â”‚  â”‚  â”œâ”€ product_likes        â”‚    â”‚
                        â”‚  â”‚  â”œâ”€ search_history       â”‚    â”‚
                        â”‚  â”‚  â”œâ”€ background_analysis  â”‚    â”‚
                        â”‚  â”‚  â””â”€ [13+ tables]         â”‚    â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                        â”‚                                     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â†‘
                                     HTTP Response
                           (body: {products, totalCount, ...})
                                           â”‚
                                           â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚      EXTERNAL API SERVICES          â”‚
                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                        â”‚                                     â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                        â”‚  â”‚   OXYLABS API                  â”‚ â”‚
                        â”‚  â”‚   realtime.oxylabs.io/v1       â”‚ â”‚
                        â”‚  â”‚                                â”‚ â”‚
                        â”‚  â”‚   â”œâ”€ Amazon Search             â”‚ â”‚
                        â”‚  â”‚   â”œâ”€ Google Shopping           â”‚ â”‚
                        â”‚  â”‚   â””â”€ Walmart Search            â”‚ â”‚
                        â”‚  â”‚                                â”‚ â”‚
                        â”‚  â”‚   Returns: ~12 products/source â”‚ â”‚
                        â”‚  â”‚   Time: 3-5s per source        â”‚ â”‚
                        â”‚  â”‚   Cost: $0.05-0.10 per call    â”‚ â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                        â”‚                                     â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                        â”‚  â”‚   OPENAI API                   â”‚ â”‚
                        â”‚  â”‚   api.openai.com/v1            â”‚ â”‚
                        â”‚  â”‚                                â”‚ â”‚
                        â”‚  â”‚   Model: gpt-4o-mini           â”‚ â”‚
                        â”‚  â”‚   Input: Product data          â”‚ â”‚
                        â”‚  â”‚   Output: Pros/cons/score      â”‚ â”‚
                        â”‚  â”‚   Time: 4-8s batch             â”‚ â”‚
                        â”‚  â”‚   Cost: $0.03-0.05 per call    â”‚ â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                        â”‚                                     â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                        â”‚  â”‚   STRIPE API                   â”‚ â”‚
                        â”‚  â”‚   api.stripe.com               â”‚ â”‚
                        â”‚  â”‚                                â”‚ â”‚
                        â”‚  â”‚   Check: Active subscriptions  â”‚ â”‚
                        â”‚  â”‚   Purpose: User access control â”‚ â”‚
                        â”‚  â”‚   Called: Once per session     â”‚ â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                        â”‚                                     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram

```
SEARCH REQUEST
    â”‚
    â”œâ”€ query: "samsung tv"
    â”œâ”€ page: 1
    â”œâ”€ sortBy: "imo_score"
    â”œâ”€ priceRange: [250, 10000]
    â”œâ”€ maxResults: 12
    â””â”€ forceRefresh: false
    â”‚
    â†“
    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EDGE FUNCTION PROCESSING           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  Extract JWT â†’ Authenticate User    â”‚
â”‚       â”‚                             â”‚
â”‚       â†“                             â”‚
â”‚  Check Stripe â†’ Verify Subscription â”‚
â”‚       â”‚                             â”‚
â”‚       â†“                             â”‚
â”‚  Set Limits â†’ Free: 3, Paid: 12     â”‚
â”‚       â”‚                             â”‚
â”‚       â†“                             â”‚
â”‚  CACHE CHECK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚       â”‚                             â”‚
â”‚       â”œâ”€ FRESH (< 7 days)           â”‚
â”‚       â”‚  â””â”€ RETURN (200ms)          â”‚
â”‚       â”‚                             â”‚
â”‚       â””â”€ STALE/MISS                 â”‚
â”‚          â””â”€ CONTINUE SCRAPING       â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCRAPING PHASE                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  OXYLABS REQUEST (Parallel)         â”‚
â”‚  â”œâ”€ Amazon Search                   â”‚
â”‚  â”‚  â”œâ”€ Send: query, filters         â”‚
â”‚  â”‚  â”œâ”€ Process: Parse HTML/DOM      â”‚
â”‚  â”‚  â””â”€ Return: 12 products (3-5s)   â”‚
â”‚  â”‚                                  â”‚
â”‚  â”œâ”€ Google Shopping Search          â”‚
â”‚  â”‚  â”œâ”€ Send: query, filters         â”‚
â”‚  â”‚  â”œâ”€ Process: Parse results       â”‚
â”‚  â”‚  â””â”€ Return: 12 products (3-5s)   â”‚
â”‚  â”‚                                  â”‚
â”‚  â””â”€ Walmart Search                  â”‚
â”‚     â”œâ”€ Send: query, filters         â”‚
â”‚     â”œâ”€ Process: Parse results       â”‚
â”‚     â””â”€ Return: 12 products (3-5s)   â”‚
â”‚                                     â”‚
â”‚  Combined: ~36 products             â”‚
â”‚  Time: ~5-8s (parallel)             â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DEDUPLICATION PHASE                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  Input: 36 products                 â”‚
â”‚  Algorithm: Title + Price matching  â”‚
â”‚  Output: ~25 unique products        â”‚
â”‚  Removed: ~11 duplicates            â”‚
â”‚  Time: 1-2s                         â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI ANALYSIS PHASE                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  BATCH: Send 25 products to OpenAI  â”‚
â”‚                                     â”‚
â”‚  For each product:                  â”‚
â”‚  â”œâ”€ Prompt: Analyze product data    â”‚
â”‚  â”œâ”€ AI Response:                    â”‚
â”‚  â”‚  â”œâ”€ pros: [3 points]             â”‚
â”‚  â”‚  â”œâ”€ cons: [3 points]             â”‚
â”‚  â”‚  â””â”€ imo_score: 1-10              â”‚
â”‚  â”‚                                  â”‚
â”‚  Time: 4-8s (batch)                 â”‚
â”‚  Cost: $0.03-0.05                   â”‚
â”‚                                     â”‚
â”‚  Output: 25 analyzed products       â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATABASE CACHING                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  INSERT INTO products:              â”‚
â”‚  â”œâ”€ 25 rows with analysis           â”‚
â”‚  â”œâ”€ Linked to query: "samsung tv"   â”‚
â”‚  â”œâ”€ created_at: NOW()               â”‚
â”‚  â””â”€ Cache duration: 7 days          â”‚
â”‚                                     â”‚
â”‚  Time: 1-2s                         â”‚
â”‚  Location: PostgreSQL (Supabase)    â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FILTERING & PAGINATION             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  SELECT * FROM products             â”‚
â”‚  WHERE query = 'samsung tv'         â”‚
â”‚  AND price BETWEEN 250 AND 10000    â”‚
â”‚  AND imo_score >= 0                 â”‚
â”‚  ORDER BY imo_score DESC            â”‚
â”‚  LIMIT 12 OFFSET 0                  â”‚
â”‚                                     â”‚
â”‚  Result: 12 products (page 1)       â”‚
â”‚  Time: < 500ms                      â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ADD METADATA                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  For each product:                  â”‚
â”‚  â”œâ”€ Get like count                  â”‚
â”‚  â”œâ”€ Check if liked by user          â”‚
â”‚  â””â”€ Add to product object           â”‚
â”‚                                     â”‚
â”‚  Time: < 500ms                      â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JSON RESPONSE                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  {                                  â”‚
â”‚    success: true,                   â”‚
â”‚    products: [                      â”‚
â”‚      {                              â”‚
â”‚        id: "uuid",                  â”‚
â”‚        title: "Samsung TV",         â”‚
â”‚        price: 599.99,               â”‚
â”‚        imo_score: 8,                â”‚
â”‚        pros: [...],                 â”‚
â”‚        cons: [...],                 â”‚
â”‚        like_count: 245,             â”‚
â”‚        liked_by_user: false,        â”‚
â”‚        ...                          â”‚
â”‚      },                             â”‚
â”‚      ... 11 more products           â”‚
â”‚    ],                               â”‚
â”‚    totalCount: 347,                 â”‚
â”‚    currentPage: 1,                  â”‚
â”‚    totalPages: 29,                  â”‚
â”‚    hasNextPage: true,               â”‚
â”‚    isFromCache: false,              â”‚
â”‚    message: "Fetched from sources"  â”‚
â”‚  }                                  â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND RENDERING                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  React Query stores in cache        â”‚
â”‚  (5 min stale, 10 min GC)           â”‚
â”‚                                     â”‚
â”‚  Display grid:                      â”‚
â”‚  â”œâ”€ Product image                   â”‚
â”‚  â”œâ”€ Title & price                   â”‚
â”‚  â”œâ”€ IMO score (â­ 8/10)             â”‚
â”‚  â”œâ”€ Site rating (4.5/5)             â”‚
â”‚  â”œâ”€ Pros & cons                     â”‚
â”‚  â”œâ”€ Like button                     â”‚
â”‚  â””â”€ View deal link                  â”‚
â”‚                                     â”‚
â”‚  Show pagination controls           â”‚
â”‚  â””â”€ Next, Previous, Page numbers    â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Request/Response Timeline

```
TIME    EVENT                                   DURATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0ms     User clicks search                      
        Request sent to edge function           
        
100ms   Edge function receives                  
        Authentication & verification           
        
150ms   Subscription check (Stripe)             
        Limits determined                       
        
200ms   Cache check begins                      
        
        CASE 1: CACHE HIT (< 7 days)
        â”œâ”€ 250ms: Found in database
        â”œâ”€ 300ms: Applied filters
        â””â”€ 350ms: Response sent âœ“
            TOTAL: ~350ms
        
        CASE 2: CACHE MISS (no data)
        â”œâ”€ 250ms: Cache miss confirmed
        â”œâ”€ 260ms: Oxylabs request started
        â”‚
        â”œâ”€ 3-5s:  Amazon results
        â”œâ”€ 3-5s:  Google results  
        â”œâ”€ 3-5s:  Walmart results (parallel)
        â”‚  COMBINED TIME: 5-8s
        â”‚
        â”œâ”€ 8s:    Deduplication (36 â†’ 25)
        â”œâ”€ 9s:    OpenAI analysis started
        â”‚  (batch processing of 25 products)
        â”œâ”€ 13-17s: Analysis complete
        â”‚
        â”œâ”€ 18s:   Database INSERT
        â”œâ”€ 19s:   Filtering & pagination
        â”œâ”€ 19.5s: Metadata added
        â””â”€ 20s:   Response sent âœ“
            TOTAL: ~10-15 seconds

NEXT TIME (same search, same day)
â”œâ”€ 0ms:  User clicks search
â”œâ”€ 100ms: Cache found âœ“
â”œâ”€ 150ms: Response sent
    TOTAL: ~200ms (50-75x faster!)
```

---

## Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        FRONTEND (React Component)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  useProductSearch Hook                       â”‚
â”‚  â”œâ”€ useQuery (React Query)                   â”‚
â”‚  â”œâ”€ Cache key: [productSearch, query, ...]   â”‚
â”‚  â””â”€ Query function: fetch to edge function   â”‚
â”‚                                              â”‚
â”‚  States:                                     â”‚
â”‚  â”œâ”€ isLoading: boolean                       â”‚
â”‚  â”œâ”€ isFetching: boolean                      â”‚
â”‚  â”œâ”€ products: Product[]                      â”‚
â”‚  â”œâ”€ totalCount: number                       â”‚
â”‚  â”œâ”€ error: Error | null                      â”‚
â”‚  â””â”€ refetch: () => Promise                   â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
      fetch('/functions/v1/fetch-products')
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SUPABASE EDGE FUNCTION (Deno)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  fetch-products/index.ts (1,450 lines)       â”‚
â”‚                                              â”‚
â”‚  Imports:                                    â”‚
â”‚  â”œâ”€ oxylabs-client (Scraping)                â”‚
â”‚  â”œâ”€ ai-service (Analysis)                    â”‚
â”‚  â”œâ”€ database-service (DB ops)                â”‚
â”‚  â”œâ”€ source-fetchers (Amazon/Google/Walmart)  â”‚
â”‚  â””â”€ Stripe, Supabase client                  â”‚
â”‚                                              â”‚
â”‚  Main flow:                                  â”‚
â”‚  â”œâ”€ Deno.serve() - HTTP handler              â”‚
â”‚  â”œâ”€ Parse request body                       â”‚
â”‚  â”œâ”€ Authenticate user                        â”‚
â”‚  â”œâ”€ Check subscription                       â”‚
â”‚  â”œâ”€ Query cache                              â”‚
â”‚  â”œâ”€ Scrape if needed                         â”‚
â”‚  â”œâ”€ Analyze with AI                          â”‚
â”‚  â”œâ”€ Save to DB                               â”‚
â”‚  â””â”€ Return response                          â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”œâ”€ oxylabs-client.ts
                 â”‚  â””â”€ makeRequest() â†’ Oxylabs API
                 â”‚
                 â”œâ”€ source-fetchers.ts
                 â”‚  â”œâ”€ AmazonOxyFetcher
                 â”‚  â”œâ”€ GoogleOxyFetcher
                 â”‚  â””â”€ WalmartOxyFetcher
                 â”‚
                 â”œâ”€ ai-service.ts
                 â”‚  â”œâ”€ analyzeProductWithAI()
                 â”‚  â””â”€ analyzeProductsBatch()
                 â”‚      â””â”€ OpenAI API
                 â”‚
                 â”œâ”€ database-service.ts
                 â”‚  â”œâ”€ searchExistingProducts()
                 â”‚  â”œâ”€ upsertProducts()
                 â”‚  â””â”€ getFreshProducts()
                 â”‚      â””â”€ Supabase RPC
                 â”‚
                 â””â”€ Supabase Client
                    â””â”€ PostgreSQL Database
                       â”œâ”€ products table
                       â”œâ”€ product_likes table
                       â””â”€ background_analysis_tasks
```

---

## Cache Lifecycle

```
TIME     STATE                ACTION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0:00     No cache             User searches "samsung tv"
         â””â”€ Full scrape       (10-15 seconds)

0:15     Fresh cache          Products saved to DB
         â””â”€ created_at: now() with timestamp

0:20     Available            User searches "samsung tv" again
         â””â”€ Cache hit         (< 200ms)

7:00     Approaching stale    User searches "samsung tv"
days     â””â”€ Still valid       (< 200ms + trigger refresh)

7:00     Stale cache          Background refresh starts
days     â””â”€ Mark as stale     Scrape fresh data

7:05     New cache            Products updated
days     â””â”€ created_at: now() Fresh for another 7 days

8:00     No cache             Cache expired
days     â””â”€ Deleted           User searches, full scrape again
                             (10-15 seconds)
```

---

## Success Metrics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PERFORMANCE TARGETS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  âœ“ First search: < 20 seconds               â”‚
â”‚  âœ“ Cached search: < 500ms                   â”‚
â”‚  âœ“ P95 latency: < 3 seconds                 â”‚
â”‚  âœ“ Cache hit rate: > 80%                    â”‚
â”‚  âœ“ Accuracy: 100% deduplication             â”‚
â”‚  âœ“ Uptime: > 99.9%                          â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COST OPTIMIZATION                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  Per 100 searches:                          â”‚
â”‚  â”œâ”€ Only 1 scrape (others cached)           â”‚
â”‚  â”œâ”€ Saves ~$10/day                          â”‚
â”‚  â”œâ”€ 50-75x faster (cached)                  â”‚
â”‚  â””â”€ Better UX overall                       â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

This architecture provides:
- âš¡ **Speed** - Caching for instant results
- ğŸ’° **Cost efficiency** - Batch processing & deduplication
- ğŸ“Š **Quality** - AI analysis for consistency
- ğŸ”’ **Access control** - Free vs paid limits
- ğŸ¯ **User experience** - Comprehensive insights

**Result: Fast, intelligent product search!** ğŸš€
